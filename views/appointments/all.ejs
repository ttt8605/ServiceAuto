<% layout('/layouts/boilerplate') %>
<div class="container">
<h1 class="mb-4">
    Programari:
</h1>


<h3 class="mb-4">Today:</h3>
 <div class="d-flex flex-row ">
<% for(let apt of appointments) {%>
    <% if(apt.date === formattedToday){ %>
       
            <div class="card mb-4 mr-4" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title mb-2 date">Data: <%= apt.date %></h5>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Ora: <%= apt.ora %></h6>
                    <h6 class="card-subtitle mb-2 text-body-secondary"> Nume: <%= apt.name %></h6>
                    <h6 class="card-subtitle mb-2 text-body-secondary"> Nr. telefon: <%= apt.phone %></h6>
                    <% if (currentUser) { %>
                        <div class="d-flex mb-2">
                            <form action="/programare/<%=apt._id %>?_method=DELETE" method="POST">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    <% } %>
                </div>
            </div>
        
    <% }} %>
</div>
<h3 class="mb-4">Future appointments:</h3>
<div class="d-flex flex-row">
<% for(let apt of appointments) {%>
    <% if(apt.date != formattedToday){ %>
        
            <div class="card mb-4 mr-4" style="width: 18rem;">
                <div class="card-body">
                    <h5 class="card-title mb-2 date">Data: <%= apt.date %></h5>
                    <h6 class="card-subtitle mb-2 text-body-secondary">Ora: <%= apt.ora %></h6>
                    <h6 class="card-subtitle mb-2 text-body-secondary"> Nume: <%= apt.name %></h6>
                    <h6 class="card-subtitle mb-2 text-body-secondary"> Nr. telefon: <%= apt.phone %></h6>
                    <% if (currentUser) { %>
                        <div class="d-flex mb-2">
                            <form action="/programare/<%=apt._id %>?_method=DELETE" method="POST">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    <% } %>
                </div>
            </div>
        
    <% }} %>
</div>
</div>

<script>
function reverseDateFormat(dateString) {
// Split the date string into its components
const [year, month, day] = dateString.split('-');

// Reformat the date components
return `${day}/${month}/${year}`;
}

// Function to update the date in the h5 elements
function updateDateTitles() {
// Select all elements with class 'date'
const dateElements = document.querySelectorAll('.date');

// Iterate over each element and update its text
dateElements.forEach(element => {
    // Extract the date part from the text content
    const originalText = element.textContent;
    const dateMatch = originalText.match(/Data: (\d{4}-\d{2}-\d{2})/);
    
    if (dateMatch) {
        const originalDate = dateMatch[1];
        const formattedDate = reverseDateFormat(originalDate);
        // Update the text content with the formatted date
        element.textContent = `Data: ${formattedDate}`;
    }
});
}

// Call the function after the page loads
document.addEventListener('DOMContentLoaded', updateDateTitles);
</script>